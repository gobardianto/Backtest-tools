<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bardianto | Multi-User Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Press+Start+2P&display=swap');
        
        :root {
            --glass: rgba(0, 0, 0, 0.7);
            --glass-border: rgba(255, 255, 255, 0.12);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #050505; 
            color: #eee; 
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background 0.5s ease;
        }

        .pixel-font { font-family: 'Press Start 2P', cursive; }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
        }

        .jelly { transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .jelly:hover { transform: scale(1.05); }

        .pixel-btn {
            background: #3b82f6;
            border: 2px solid #000;
            box-shadow: 4px 4px 0px #000;
            color: white;
            padding: 10px 20px;
            text-transform: uppercase;
            font-weight: 800;
            font-size: 10px;
            transition: 0.1s;
            cursor: pointer;
        }
        .pixel-btn:active {
            box-shadow: 0px 0px 0px #000;
            transform: translate(2px, 2px);
        }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .input-field {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 14px;
            border-radius: 12px;
            width: 100%;
            font-size: 14px;
            color: white;
            outline: none;
        }
    </style>
</head>
<body id="main-body">

    <nav class="fixed top-0 w-full z-50 p-4 flex justify-center">
        <div class="glass-card w-full max-w-4xl px-6 py-3 flex items-center justify-between shadow-2xl">
            <div class="flex items-center gap-3 cursor-pointer jelly" onclick="window.location.href=window.location.origin + window.location.pathname">
                <img src="icon-1.png" alt="Logo" class="w-8 h-8 object-contain rounded" onerror="this.src='https://ui-avatars.com/api/?name=B&background=3b82f6&color=fff'">
                <span class="pixel-font text-[9px] tracking-tighter hidden sm:block">SYSTEM.PORTAL</span>
            </div>
            <div class="flex gap-6 items-center">
                <button onclick="goTo('home')" class="text-[10px] font-extrabold uppercase tracking-widest hover:text-blue-400 transition">Beranda</button>
                <div id="nav-auth"></div>
                <button onclick="shareLink()" class="jelly text-green-500 bg-green-500/10 p-2 rounded-full"><i data-lucide="share-2" class="w-4 h-4"></i></button>
            </div>
        </div>
    </nav>

    <main id="home" class="page active pt-32 pb-20 px-6">
        <div class="max-w-4xl mx-auto space-y-16">
            <header class="text-center space-y-8">
                <div class="jelly inline-block relative">
                    <div class="absolute inset-0 bg-blue-500/20 blur-3xl rounded-full"></div>
                    <img id="profile-img" src="" class="relative w-28 h-28 md:w-36 md:h-36 rounded-full border-4 border-black object-cover shadow-2xl mx-auto">
                </div>
                <div class="space-y-4">
                    <h1 class="text-5xl md:text-6xl font-extrabold tracking-tighter" id="disp-name">Memuat...</h1>
                    <div class="glass-card inline-block px-8 py-4 max-w-2xl">
                        <p class="text-gray-300 text-sm md:text-base leading-relaxed" id="disp-bio">Menghubungkan ke portal...</p>
                    </div>
                </div>
                <div id="home-socials" class="flex justify-center gap-4 flex-wrap"></div>
            </header>

            <section class="space-y-8">
                <div class="flex items-center gap-4">
                    <span class="pixel-font text-[8px] text-blue-500">PROYEK_SAYA</span>
                    <div class="h-[1px] flex-grow bg-white/10"></div>
                </div>
                <div id="home-projects" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
            </section>
        </div>
    </main>

    <div id="admin" class="page pt-28 px-6 pb-20">
        <div class="max-w-6xl mx-auto space-y-8">
            <div class="glass-card p-6 flex flex-wrap gap-4 justify-between items-center">
                <div>
                    <h2 class="text-2xl font-black uppercase italic">Dashboard</h2>
                    <p class="text-[10px] text-blue-400 font-bold" id="user-email-display"></p>
                </div>
                <div class="flex gap-2">
                    <button onclick="doLogout()" class="pixel-btn !bg-red-600">Logout</button>
                </div>
            </div>

            <div class="grid lg:grid-cols-3 gap-6">
                <div class="glass-card p-6 space-y-6">
                    <h3 class="pixel-font text-[8px] text-blue-400">PENGATURAN</h3>
                    <div class="space-y-4">
                        <input type="text" id="adm-name" class="input-field text-xs" placeholder="Nama Tampilan">
                        <textarea id="adm-bio" class="input-field h-24 text-xs" placeholder="Bio Singkat"></textarea>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="triggerUpload('profile')" class="pixel-btn !bg-blue-600 !p-2 text-[8px]">FOTO</button>
                            <button onclick="triggerUpload('bg')" class="pixel-btn !bg-purple-600 !p-2 text-[8px]">BACKGROUND</button>
                        </div>
                        <input type="file" id="file-uploader" class="hidden" accept="image/*" onchange="handleUploader(this)">
                        <button onclick="updateSettings()" class="pixel-btn w-full !bg-green-600">Simpan Profil</button>
                    </div>
                </div>

                <div class="glass-card p-6 space-y-6">
                    <h3 class="pixel-font text-[8px] text-blue-400">MEDIA SOSIAL</h3>
                    <form onsubmit="insertData(event, 'social_media')" class="space-y-3">
                        <input type="text" name="platform" placeholder="Tiktok, WA, Instagram, dll" required class="input-field text-xs">
                        <input type="url" name="url" placeholder="https://..." required class="input-field text-xs">
                        <button class="pixel-btn w-full">Tambah Sosial</button>
                    </form>
                    <div id="adm-socials" class="space-y-2 max-h-60 overflow-y-auto"></div>
                </div>

                <div class="glass-card p-6 space-y-6">
                    <h3 class="pixel-font text-[8px] text-blue-400">DAFTAR KARYA</h3>
                    <form onsubmit="insertData(event, 'projects')" class="space-y-3">
                        <input type="text" name="title" placeholder="Nama Proyek" required class="input-field text-xs">
                        <input type="url" name="url" placeholder="Link Proyek" required class="input-field text-xs">
                        <button class="pixel-btn w-full">Tambah Proyek</button>
                    </form>
                    <div id="adm-projects" class="space-y-2 max-h-60 overflow-y-auto"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="login" class="page pt-44 px-6">
        <div class="max-w-sm mx-auto glass-card p-10 space-y-8">
            <h2 class="pixel-font text-[10px] text-center">MASUK_SISTEM</h2>
            <form id="form-login" class="space-y-4">
                <input type="email" id="email" placeholder="EMAIL" required class="input-field">
                <input type="password" id="pass" placeholder="PASSWORD" required class="input-field">
                <button type="submit" id="btn-login" class="pixel-btn w-full">Masuk Sekarang</button>
            </form>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] transform translate-y-20 opacity-0 transition-all duration-300">
        <div class="bg-white text-black px-8 py-3 rounded-full font-bold text-xs shadow-2xl" id="toast-msg"></div>
    </div>

    <script>
        const SB_URL = "https://vikzpwxrzjniandnukxs.supabase.co";
        const SB_KEY = "sb_publishable_X-Tmbexgd95TpgIgU4UTfQ_Y1uxwSp6";
        const _sb = supabase.createClient(SB_URL, SB_KEY);

        let userSession = null;
        let currentUploadType = 'profile';

        // Custom SVGs for platforms
        const CUSTOM_ICONS = {
            tiktok: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 448 512"><path d="M448,209.91a210.06,210.06,0,0,1-122.77-39.25V349.38A162.55,162.55,0,1,1,185,188.31V278.2a74.62,74.62,0,1,0,52.23,71.18V0l88,0a121.18,121.18,0,0,0,1.86,22.17h0A122.18,122.18,0,0,0,381,102.39a121.43,121.43,0,0,0,67,20.14Z"/></svg>`,
            whatsapp: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 448 512"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-5.5-2.8-23.2-8.5-44.2-27.1-16.4-14.6-27.4-32.7-30.6-38.1-3.2-5.5-.3-8.4 2.4-11.2 2.5-2.5 5.5-6.5 8.3-9.7 2.8-3.3 3.7-5.5 5.5-9.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 13.2 5.8 23.5 9.2 31.5 11.8 13.3 4.2 25.4 3.6 35 2.2 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>`,
            facebook: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>`
        };

        window.onload = async () => {
            const { data: { session } } = await _sb.auth.getSession();
            userSession = session?.user || null;
            updateAuthUI();
            
            const params = new URLSearchParams(window.location.search);
            const viewUid = params.get('u');

            if (viewUid) fetchContent(viewUid);
            else if (userSession) fetchContent(userSession.id);
        };

        function goTo(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            lucide.createIcons();
        }

        function updateAuthUI() {
            const nav = document.getElementById('nav-auth');
            nav.innerHTML = userSession 
                ? `<button onclick="goTo('admin')" class="text-[10px] font-bold text-blue-400 bg-blue-400/10 px-4 py-2 rounded-full">ADMIN</button>`
                : `<button onclick="goTo('login')" class="text-[10px] font-bold hover:text-blue-400">LOGIN</button>`;
        }

        async function fetchContent(uid) {
            const { data: set } = await _sb.from('settings').select('*').eq('user_id', uid).maybeSingle();
            if (set) {
                document.getElementById('disp-name').innerText = set.site_name || 'Bardianto';
                document.getElementById('disp-bio').innerText = set.bio || '';
                document.getElementById('profile-img').src = set.profile_image_url || `https://ui-avatars.com/api/?name=${set.site_name}`;
                if (set.background_url) document.body.style.backgroundImage = `url('${set.background_url}')`;

                if(userSession?.id === uid) {
                    document.getElementById('adm-name').value = set.site_name || '';
                    document.getElementById('adm-bio').value = set.bio || '';
                    document.getElementById('user-email-display').innerText = userSession.email;
                }
            } else if (userSession?.id === uid) {
                await _sb.from('settings').insert([{ user_id: uid, site_name: 'User Baru' }]);
                fetchContent(uid);
            }

            const { data: soc } = await _sb.from('social_media').select('*').eq('user_id', uid);
            const { data: proj } = await _sb.from('projects').select('*').eq('user_id', uid);

            renderPublic(soc || [], proj || []);
            if(userSession?.id === uid) renderAdmin(soc || [], proj || []);
            lucide.createIcons();
        }

        function renderPublic(soc, proj) {
            document.getElementById('home-socials').innerHTML = soc.map(s => {
                const p = s.platform.toLowerCase().replace(/\s+/g, '');
                let iconHtml = '';

                if (p.includes('tiktok') || p === 'tt') iconHtml = CUSTOM_ICONS.tiktok;
                else if (p.includes('whatsapp') || p === 'wa') iconHtml = CUSTOM_ICONS.whatsapp;
                else if (p.includes('facebook') || p === 'fb') iconHtml = CUSTOM_ICONS.facebook;
                else iconHtml = `<i data-lucide="${getLucideIcon(p)}" class="w-5 h-5"></i>`;

                return `<a href="${s.url}" target="_blank" class="glass-card p-4 jelly text-gray-300 hover:text-white shadow-lg">${iconHtml}</a>`;
            }).join('');

            document.getElementById('home-projects').innerHTML = proj.map(p => `
                <a href="${p.url}" target="_blank" class="glass-card flex flex-col items-center justify-center p-6 jelly aspect-square text-center">
                    <i data-lucide="layout" class="w-6 h-6 text-blue-500 mb-3"></i>
                    <h3 class="text-[10px] font-bold uppercase">${p.title}</h3>
                </a>
            `).join('');
        }

        function renderAdmin(soc, proj) {
            document.getElementById('adm-socials').innerHTML = soc.map(s => `
                <div class="flex justify-between p-3 glass-card bg-white/5 text-[10px] mb-2 border-white/5">
                    <span class="font-bold">${s.platform}</span>
                    <button onclick="removeData('social_media', ${s.id})" class="text-red-500 hover:underline">Hapus</button>
                </div>
            `).join('');
            document.getElementById('adm-projects').innerHTML = proj.map(p => `
                <div class="flex justify-between p-3 glass-card bg-white/5 text-[10px] mb-2 border-white/5">
                    <span class="truncate max-w-[120px] font-bold">${p.title}</span>
                    <button onclick="removeData('projects', ${p.id})" class="text-red-500 hover:underline">Hapus</button>
                </div>
            `).join('');
        }

        function getLucideIcon(p) {
            if (p.includes('instagram') || p === 'ig') return 'instagram';
            if (p.includes('github')) return 'github';
            if (p.includes('youtube') || p === 'yt') return 'youtube';
            if (p.includes('linkedin')) return 'linkedin';
            if (p.includes('twitter') || p === 'x') return 'twitter';
            if (p.includes('mail')) return 'mail';
            return 'external-link';
        }

        async function triggerUpload(type) {
            currentUploadType = type;
            document.getElementById('file-uploader').click();
        }

        async function handleUploader(input) {
            const file = input.files[0];
            if (!file) return;
            showToast("âŒ› Mengunggah...");
            const path = `${userSession.id}/${currentUploadType}_${Date.now()}`;
            const { error } = await _sb.storage.from('uploads').upload(path, file);
            if (error) return showToast("âŒ Gagal Mengunggah");

            const { data: { publicUrl } } = _sb.storage.from('uploads').getPublicUrl(path);
            const col = currentUploadType === 'profile' ? 'profile_image_url' : 'background_url';
            await _sb.from('settings').update({ [col]: publicUrl }).eq('user_id', userSession.id);
            showToast("âœ… Berhasil Diperbarui");
            fetchContent(userSession.id);
        }

        async function updateSettings() {
            await _sb.from('settings').update({ 
                site_name: document.getElementById('adm-name').value,
                bio: document.getElementById('adm-bio').value
            }).eq('user_id', userSession.id);
            showToast("âœ… Profil Disimpan");
            fetchContent(userSession.id);
        }

        async function insertData(e, table) {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            data.user_id = userSession.id;
            await _sb.from(table).insert([data]);
            e.target.reset();
            fetchContent(userSession.id);
            showToast("âœ… Data Ditambahkan");
        }

        async function removeData(table, id) {
            await _sb.from(table).delete().eq('id', id);
            fetchContent(userSession.id);
            showToast("ðŸ—‘ï¸ Berhasil Dihapus");
        }

        async function shareLink() {
            const uid = userSession?.id || new URLSearchParams(window.location.search).get('u');
            if(!uid) return;
            const url = `${window.location.origin}${window.location.pathname}?u=${uid}`;
            navigator.clipboard.writeText(url);
            showToast("ðŸ“‹ Tautan disalin ke papan klip!");
        }

        document.getElementById('form-login').onsubmit = async (e) => {
            e.preventDefault();
            const { data, error } = await _sb.auth.signInWithPassword({
                email: document.getElementById('email').value,
                password: document.getElementById('pass').value
            });
            if(!error) { 
                userSession = data.user; 
                updateAuthUI(); 
                goTo('admin'); 
                fetchContent(userSession.id); 
                showToast("ðŸš€ Berhasil Masuk");
            } else showToast("âŒ Login Gagal");
        };

        async function doLogout() {
            await _sb.auth.signOut();
            window.location.reload();
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
        }
    </script>
</body>
</html>

